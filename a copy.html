<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<title>Privnote - Character Encryption</title>
<meta name="keywords" content="zero-width character encryption, binary encryption, secure messaging, encrypted notes, ephemeral messages,隐信云">
<meta name="description" content="Privnote.chat allows you to encrypt messages using zero-width characters and binary formats, ensuring secure and private messaging.">
<meta property="og:image" content="privnote.png">
<meta property="og:url" content="https://privnote.chat/encryption.html">
<link rel="canonical" href="https://privnote.chat/encryption.html">
<meta property="og:type" content="website">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Bootstrap & Font Awesome -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9224406325142860" crossorigin="anonymous"></script>
<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">

<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "Organization",
"name": "Privnote",
"url": "https://privnote.chat",
"logo": "https://privnote.chat/read/pic/noti.png",
"contactPoint": {
"@type": "ContactPoint",
"email": "contact@privnote.chat",
"contactType": "customer service"
}
}
</script>

<style>
/* Enhanced Mobile Header Styles */
@media (max-width: 767px) {
  .site-header {
    padding: 10px 5px;
    background-color: #343a40;
  }
  .logo-text {
    font-size: 1.3rem;
    margin-bottom: 0;
    white-space: nowrap;
  }
  .logo-container {
    display: flex;
    align-items: center;
  }
  .logo-icon {
    color: #FFC107;
    font-size: 1.3rem;
    margin-right: 3px;
  }
  .language-dropdown {
    margin-right: 5px;
  }
  .language-dropdown .btn {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
  }
  .tagline {
    display: none;
  }
  .mobile-tagline {
    display: block;
    text-align: center;
    font-size: 0.75rem;
    color: rgba(255, 255, 255, 0.8);
    margin-top: 5px;
    font-style: italic;
  }
  .header-row {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }
  .header-controls {
    display: flex;
    align-items: center;
  }
  
  /* Improved mobile navigation */
  #mainNav {
    overflow-x: auto;
    flex-wrap: nowrap;
    padding-bottom: 2px;
    max-width: 100%;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
  }
  #mainNav::-webkit-scrollbar {
    display: none; /* Chrome, Safari, Opera */
  }
  #mainNav .nav-link {
    padding: 0.4rem 0.6rem;
    white-space: nowrap;
    font-size: 0.9rem;
  }
  
  /* Improved form controls for mobile */
  .main-container {
    padding: 0 8px;
  }
  .form-label {
    font-size: 0.85rem;
    margin-bottom: 0.2rem;
  }
  textarea.form-control {
    font-size: 0.9rem;
    padding: 0.4rem;
  }
  .btn {
    padding: 0.35rem 0.65rem;
    font-size: 0.9rem;
  }
  
  /* Improved alert and card styling */
  .alert {
    padding: 0.6rem;
    font-size: 0.85rem;
  }
  .card-body {
    padding: 0.75rem;
  }
  
  /* Fix dropdown on mobile */
  .dropdown-menu {
    position: absolute;
    min-width: 7rem;
  }
}

/* Extra small devices (phones, 576px and down) */
@media (max-width: 576px) {
  .site-header {
    padding: 8px 4px;
  }
  .logo-text {
    font-size: 1.2rem;
  }
  .logo-icon {
    font-size: 1.2rem;
  }
  #mainNav .nav-link {
    padding: 0.35rem 0.5rem;
    font-size: 0.85rem;
  }
  h5.mb-3 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem !important;
  }
  .form-label {
    font-size: 0.8rem;
  }
  .row.mb-3 {
    margin-bottom: 0.5rem !important;
  }
  textarea.form-control, input.form-control {
    font-size: 0.85rem;
    padding: 0.35rem;
  }
  .btn {
    font-size: 0.85rem;
    padding: 0.3rem 0.6rem;
  }
}

@media (min-width: 768px) {
  .mobile-tagline {
    display: none;
  }
}

/* Add button hover/active states for better mobile feedback */
.btn:active {
  transform: translateY(1px);
}

/* Ensure scrolling works properly on mobile */
body {
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
}

/* Fix modal display on mobile */
.modal-dialog {
  margin: 0.5rem;
}
@media (max-width: 576px) {
  .modal-dialog {
    max-width: 95%;
    margin: 0.25rem auto;
  }
  .modal-body {
    padding: 0.5rem;
  }
  .modal-footer, .modal-header {
    padding: 0.5rem;
  }
}
</style>

</head>

<body class="d-flex flex-column min-vh-100">
<header class="site-header">
<div class="container-fluid d-flex justify-content-between align-items-center">
<a class="text-decoration-none" href="https://privnote.chat">
<h1 class="logo-text">Priv<i class="fas fa-unlock-alt"></i>ote.chat</h1>
</a>
<div class="d-flex align-items-center">
<div class="dropdown me-3">
<button class="btn btn-sm btn-outline-light dropdown-toggle" type="button" id="languageDropdown" data-bs-toggle="dropdown" aria-expanded="false">
<i class="fas fa-globe me-1"></i><span id="currentLanguage">EN</span>
</button>
<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="languageDropdown">
<li><a class="dropdown-item" href="#" onclick="switchLanguage('en')">English</a></li>
<li><a class="dropdown-item" href="#" onclick="switchLanguage('zh')">中文</a></li>
<li><a class="dropdown-item" href="#" onclick="switchLanguage('es')">Español</a></li>
<li><a class="dropdown-item" href="#" onclick="switchLanguage('fr')">Français</a></li>
</ul>
</div>
<div id="trans1" class="tagline">Secure your words, vanish your trace</div>
</div>
</div>
</header>

<!-- Navigation Links -->
<div class="container">
  <ul class="nav nav-tabs justify-content-center mb-4" id="mainNav">
    <li class="nav-item">
      <a class="nav-link" href="index.html">
        <span id="navLinkText">Generate Link</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link active" href="encryption.html">
        <span id="navEncryptText">Character Encryption</span>
      </a>
    </li>
    <li class="nav-item">
      <a class="nav-link" href="decrypt.html">
        <span id="navDecryptText">Decrypt</span>
      </a>
    </li>
  </ul>
</div>

<main class="flex-grow-1">
<div class="container main-container">
    <h5 class="mb-3 mt-4 pt-2 text-center" id="encryptTabTitle">Character Encryption Tool</h5>

    <!-- First textarea - Input area -->
    <div class="mb-3">
      <label for="myTextarea" class="form-label"><i class="fas fa-edit me-1"></i>Public Message (Input)</label>
      <textarea class="form-control" id="myTextarea" rows="5" placeholder="Write Your Note Here..." style="border-left: 4px solid #3498db;"></textarea>
    </div>
    
    <!-- Hidden textarea - will be moved to bottom after encryption -->
    <div class="mb-3" id="hiddenTextContainer">
      <label for="HiddenTextarea" class="form-label"><i class="fas fa-eye-slash me-1"></i>Secret Message (Input)</label>
      <textarea class="form-control" id="HiddenTextarea" rows="5" placeholder="Write Hidden Messages Here..." style="border-left: 4px solid #9b59b6;"></textarea>
    </div>

    <!-- Password inputs -->
    <div class="row mb-3">
      <div class="col-md-6 mb-2 mb-md-0">
        <label for="pass1" class="form-label">Password</label>
        <input type="password" class="form-control" id="pass1" placeholder="Enter Password" autocomplete="off" required>
      </div>
      <div class="col-md-6">
        <label for="pass2" class="form-label">Confirm Password</label>
        <input type="password" class="form-control" id="pass2" placeholder="Confirm Password" required>
      </div>
    </div>

    <!-- Encrypt button -->
    <div class="d-grid gap-2 d-md-flex justify-content-md-center mb-4">
      <button id="tranmake" type="button" class="btn btn-warning px-4 py-2" onclick="create()">
        <i class="fas fa-lock me-2"></i>Encrypt Note
      </button>
    </div>

    <!-- Result display area -->
    <div class="alert alert-success" id="encryptinfo" style="display: none">
      <strong>Success!</strong> <span>The note has been successfully encrypted with two methods: the upper box contains zero-width character encryption, storing the information within the text, while the lower box shows the encryption as binary (0s and 1s). Both can be copied and used for decryption.</span>
    </div>

    <!-- Cover text copy area - 使用红色主题 -->
    <div class="mb-3">
      <label for="coverCopy" class="form-label"><i class="fas fa-key me-1"></i>Zero-Width Encrypted Result (Copy to Share)</label>
      <textarea class="form-control mb-2" id="coverCopy" rows="5" placeholder="Encrypted content will appear here" readonly style="border-left: 4px solid #dc3545; background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 240, 0.9)) !important;"></textarea>
      <div class="d-flex justify-content-center">
        <button class="btn btn-danger" type="button" onclick="copyTextarea('coverCopy')">
          <i class="fas fa-copy me-2"></i>Copy Zero-Width Result
        </button>
      </div>
    </div>

    <!-- Card for link generation -->
    <div class="card" id="resultlink" style="display: none">
      <div class="card-body">
        <h6 class="card-title">PrivNote has been made</h6>
        <ul class="list-group list-group-flush mb-3">
          <li class="list-group-item list-group-item-success" id="innerlink"></li>
          <li id="tranli" class="list-group-item list-group-item-warning">The message will be automatically destroyed according to your settings.</li>
        </ul>
        <button type="button" class="btn btn-outline-secondary" id="copybutton" onclick="copylink()">
          <i class="fas fa-copy me-2"></i>Copy Link
        </button>
      </div>
    </div>
    
    <!-- Container for Hidden Text after encryption -->
    <div id="hiddenTextAfterEncrypt"></div>
</div>
</main>

<footer class="mt-auto">
<div class="container">
<p class="text-center mb-0">
<a href="read/selfdestructANDencoding.php" class="nav-link">
&copy;2025 MaiPDF.com<br><span class="__cf_email__" data-cfemail="b7ddd8d2f7c7d3d1dfd8c4c399d8d9dbded9d2">[email&#160;protected]</span>
</a>
</p>
</div>
</footer>

<div class="modal fade" id="myModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">How to decode messages</h4>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <img id="decrysrc" src="read/pic/enDecode1.png" class="img-fluid" alt="changecode">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<!-- 移动 translate.js 到最后加载 -->
<script>
// Encryption functions

//console.log(convertTime2(343434));
const url = window.location.href;
const regex = /prive\/(\d+)\/note/;
const match = url.match(regex);

//console.log(match); // logs "2146489127"




let myCookieValue = document.cookie
  .split('; ')
  .find(cookie => cookie.startsWith('cookiefilenumber='))
  ?.split('=')[1];
if (myCookieValue) {
  ///console.log(myCookieValue);

   const numberoffile = myCookieValue;
   const buttcontent = document.getElementById('containerbox');
   buttcontent.innerHTML = '<h3><div class="spinner-grow text-muted"></div><div class="spinner-grow text-primary"></div><div class="spinner-grow text-success"></div><div class="spinner-grow text-info"></div><div class="spinner-grow text-warning"></div><div class="spinner-grow text-danger"></div><div class="spinner-grow text-secondary"></div><div class="spinner-grow text-dark"></div><div class="spinner-grow text-light"></div></h3>';

  document.cookie = "cookiefilenumber=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";


} else {
  //console.log("Cookie not found.");
  // document.getElementById('grabify').style.display='block';
}




if(match !== null){
  const numberoffile = match[1];
  

}

var textareaValue='';
var expiretime = 0;
var confirmask = 1;
var pass1=''; var pass2='';
var containerbox = document.getElementById('demo');
var buttontwo = document.getElementById('buttontwo');
var myArray = '';
var lastElement = '';
var globename='';
var combineallvalue='';
function copylink(){
     const exampleLi = document.getElementById('innerlink'); // select the <li> element with id "example"
     const exampleText = exampleLi.textContent; // get the text content of the <li> element
     navigator.clipboard.writeText(exampleText) // copy the text to the clipboard
  .then(() => {

var button = document.getElementById("copybutton");
button.classList.add('rotate');
button.textContent = "Link Copied";

  })
  .catch((err) => {
    console.error('Error copying text: ', err);
  });

}


// 加密过程：使用XOR对文本进行加密，并转换为0和1的二进制
function textToBinaryEncryption(text, key) {
    const keyCodes = Array.from(key).map(char => char.charCodeAt(0));  // 转换密钥为字符的charCode数组

    // 第一步：对每个字符进行XOR加密，并转换为二进制
    const encryptedText = Array.from(text).map((char, index) => {
        // 使用密钥字符的charCode与当前字符的charCode进行异或运算
        let charCode = char.charCodeAt(0) ^ keyCodes[index % keyCodes.length];
        
        // 转换为二进制，返回的是0和1的字符串（每个字符的16位二进制表示）
        return charCode.toString(2).padStart(16, '0'); // 每个字符的二进制表示为16位
    }).join('');

    return encryptedText;
}

// 解密过程：从0和1的二进制恢复原始文本
function binaryToTextDecryption(binaryText, key) {
    const keyCodes = Array.from(key).map(char => char.charCodeAt(0));  // 转换密钥为字符的charCode数组

    // 分割二进制字符串为每16位一组（每个字符的16位二进制表示）
    const text = binaryText.match(/.{16}/g).map((bin, index) => {
        // 将二进制字符串转为整数（字符编码），并进行XOR解密
        let charCode = parseInt(bin, 2) ^ keyCodes[index % keyCodes.length];
        return String.fromCharCode(charCode);
    }).join('');

    return text;
}

// 使用统一的 16 位二进制进行 XOR 加密，并转换为零宽字符
function textToZeroWidthWithDoubleEncryption(text, key) {
    // 将密钥字符串转为字符的 charCode 数组
    const keyCodes = Array.from(key).map(char => char.charCodeAt(0));

    // 第一步：XOR 加密
    const xorEncryptedText = Array.from(text).map((char, index) => {
        // 使用 keyCodes 中的字符与原始字符的 charCode 进行异或运算
        let charCode = char.charCodeAt(0) ^ keyCodes[index % keyCodes.length];
        
        // 将字符编码强制为 16 位二进制字符串，确保统一长度
        return charCode.toString(2).padStart(16, '0');
    }).join('');

    // 第二步：将 XOR 加密后的二进制转换为零宽字符
    return xorEncryptedText.split('').map(bit => bit === '0' ? '\u200B' : '\u200C').join('');
}


// 解密流程：先解码零宽字符，再使用 XOR 解密
function zeroWidthToTextWithDoubleDecryption(zeroWidthText, key) {
    // 将密钥字符串转为字符的 charCode 数组
    const keyCodes = Array.from(key).map(char => char.charCodeAt(0));

    // 将零宽字符转换为二进制字符串
    const binary = Array.from(zeroWidthText).map(char => {
        return char === '\u200B' ? '0' : '1';
    }).join('');

    // 每16个二进制位恢复为一个字符
    const text = binary.match(/.{16}/g).map((bin, index) => {
        let charCode = parseInt(bin, 2) ^ keyCodes[index % keyCodes.length];
        return String.fromCharCode(charCode);
    }).join('');

    // 检查并替换最后一个字符是否是非法字符（如半角字符）
    if (text.charCodeAt(text.length - 1) < 32 || text.charCodeAt(text.length - 1) > 126) {
        // 如果最后一个字符是非法字符（如换行符、回车符），就替换为空格
        return text.slice(0, -1) + ' ';
    }
    return text;
}

function decoding(){
  const textarea = document.getElementById('myTextarea'); // Get the textarea element by its ID
  textareaValue = textarea.value; 
  
  
  pass1 = document.getElementById('pass1').value;
  pass2 = document.getElementById('pass2').value;
  if (pass1 === "" && pass2 === "") {
    pass1 = 'mythenigma';
  }
  const isBinary = /^[01]+$/.test(textareaValue);
  let decodedSecretMessage;

if (isBinary) {
   decodedSecretMessage = binaryToTextDecryption(textareaValue,pass1);
 console.log(decodedSecretMessage);
} else {
  const encodedSecretPart = textareaValue.slice(0, textareaValue.length);  // 提取加密部分
  decodedSecretMessage = zeroWidthToTextWithDoubleDecryption(encodedSecretPart, pass1);  // 解密加密部分
}

  //console.log(decodedSecretMessage);
  simulateTyping("HiddenTextarea",decodedSecretMessage, 100);
}

function create() {
   const textarea = document.getElementById('myTextarea');
   textareaValue = textarea.value; 
   const hiddentext = document.getElementById('HiddenTextarea');
   hiddentextValue = hiddentext.value; hiddentextValue += ' \n ';
  let totallength = textareaValue.length + hiddentextValue.length ;

  if(totallength > 30000){
    alert(getLocalizedString('alertContentTooLong', 'encryption'));
    return ;
  }


if (textareaValue === ""){
  alert(getLocalizedString('alertWriteSomething', 'encryption'));
  return ;
}

   pass1 = document.getElementById('pass1').value;
   pass2 = document.getElementById('pass2').value;
   //console.log(pass1);
  if (pass1 === "" && pass2 === "") {
    pass1 = 'mythenigma';  } else if (pass1 === pass2) {
    pass1 = pass2;
  } else {
    alert(getLocalizedString('alertPasswordMismatch', 'encryption'));
    return;
  }


 const encodedSecretMessage = textToZeroWidthWithDoubleEncryption(hiddentextValue, pass1);
 const encodedSecretMessage01= textToBinaryEncryption(hiddentextValue, pass1); 
 combineallvalue =  encodedSecretMessage + textareaValue;
 textareaValue   =  combineallvalue;
 textarea.value  =  combineallvalue;
 hiddentext.value=   encodedSecretMessage01;
 
 // Show the result
 document.getElementById('encryptinfo').style.display = 'block';
 document.getElementById('coverCopy').value = textarea.value;
 
 // 将HiddenText框移动到最下面
 const hiddenTextContainer = document.getElementById('hiddenTextContainer');
 const hiddenTextAfterEncrypt = document.getElementById('hiddenTextAfterEncrypt');
 const hiddenTextArea = document.getElementById('HiddenTextarea');
 
 // 修改标签文本，更清晰地表示这是二进制加密结果
 const label = hiddenTextContainer.querySelector('label');
 label.innerHTML = '<i class="fas fa-code me-1"></i>Binary Encryption Result';
 
 // 从父元素中移除原始 textarea
 const hiddenTextParent = hiddenTextArea.parentNode;
 hiddenTextParent.removeChild(hiddenTextArea);
 
 // 给二进制结果框添加左边框样式 - 使用蓝色
 hiddenTextArea.style.borderLeft = '4px solid #17a2b8';
 hiddenTextArea.style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 240, 0.9))';
 hiddenTextArea.className = 'form-control mb-2'; // 添加 mb-2 以在文本框和按钮之间创建间距
 
 // 将原始 textarea 添加回父容器
 hiddenTextParent.appendChild(hiddenTextArea);
 
 // 显示结果
 document.getElementById('coverCopy').style.borderLeft = '4px solid #dc3545';
 document.getElementById('coverCopy').style.background = 'linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 240, 240, 0.9))';
 
 // 创建复制按钮并添加到文本框下方
 const copyButton = document.createElement('button');
 copyButton.className = 'btn btn-info';  // 使用蓝色按钮(info)，区别于上面的红色按钮(danger)
 copyButton.type = 'button';
 copyButton.innerHTML = '<i class="fas fa-copy me-2"></i>Copy Binary Result';
 copyButton.onclick = function() { copyTextarea('HiddenTextarea'); };
 copyButton.style.width = 'auto'; // 设置按钮宽度为自动
 copyButton.style.display = 'block'; // 设置为块级元素
 
 // 创建一个按钮容器，用于居中显示按钮
 const buttonContainer = document.createElement('div');
 buttonContainer.className = 'd-flex justify-content-center';
 buttonContainer.appendChild(copyButton);
 
 // 将按钮容器添加到父容器
 hiddenTextParent.appendChild(buttonContainer);
 
 // 从原位置移除并附加到底部容器
 hiddenTextAfterEncrypt.appendChild(hiddenTextContainer);
 
 // 添加一些顶部间距，使其与上面的内容有更好的视觉分隔
 hiddenTextContainer.classList.add('mt-4');
}

function copyTextarea(id) {
    var textarea = document.getElementById(id);
    textarea.select();
    document.execCommand('copy');
    
    // Visual feedback for copy
    let button;
    if (id === 'coverCopy') {
        // 直接找到按钮而不是使用 nextElementSibling
        button = document.querySelector('.btn.btn-danger[onclick="copyTextarea(\'coverCopy\')"]');
    } else {
        // 二进制结果的按钮，因为是动态创建的，使用部分匹配
        button = document.querySelector('.btn.btn-info[onclick*="' + id + '"]');
    }
    
    if (button) {
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check me-2"></i>Copied!';
        
        setTimeout(() => {
            button.innerHTML = originalText;
        }, 2000);
    }
}

// 添加模拟打字效果的函数，以便decoding函数可以正常工作
function simulateTyping(elementId, text, speed) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    element.value = '';
    let i = 0;
    
    function type() {
        if (i < text.length) {
            element.value += text.charAt(i);
            i++;
            setTimeout(type, speed);
        }
    }
    
    type();
}

// Add a function to check screen size and adjust UI elements
function adjustForMobileView() {
  if (window.innerWidth < 768) {
    // Adjust textarea rows for better mobile viewing
    document.querySelectorAll('textarea').forEach(textarea => {
      textarea.rows = 4;
    });    // Ensure the alert message is concise on mobile
    const alertSpan = document.querySelector('#encryptinfo span');
    if (alertSpan) {
      if (window.innerWidth < 576) {
        alertSpan.textContent = getLocalizedString('mobileAlertShort', 'encryption') || 
                               'Encryption successful! Upper box: zero-width characters. Lower box: binary format.';
      } else if (window.innerWidth < 768) {
        alertSpan.textContent = getLocalizedString('mobileAlertMedium', 'encryption') || 
                               'Encryption complete. The top box contains zero-width character encryption, while the bottom shows binary encryption.';
      }
    }
    
    // Adjust button text for smaller screens
    const copyZeroWidthBtn = document.querySelector('.btn.btn-danger[onclick="copyTextarea(\'coverCopy\')"]');
    if (copyZeroWidthBtn && window.innerWidth < 400) {
      copyZeroWidthBtn.innerHTML = '<i class="fas fa-copy me-1"></i>Copy';
    }
  }
}

// Call the function on page load and resize
window.addEventListener('load', adjustForMobileView);
window.addEventListener('resize', adjustForMobileView);

// Modify create() function to handle mobile displays better
const originalCreate = create;
create = function() {
  originalCreate();
  
  // After encryption, if on mobile, modify the dynamically created button text to be shorter
  if (window.innerWidth < 400) {
    const binaryResultBtn = document.querySelector('.btn.btn-info[onclick*="HiddenTextarea"]');
    if (binaryResultBtn) {
      binaryResultBtn.innerHTML = '<i class="fas fa-copy me-1"></i>Copy';
    }
  }
  
  // Scroll to the results on mobile
  if (window.innerWidth < 768) {
    document.getElementById('encryptinfo').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
  }
}

// 确保DOM加载完成后再执行初始化
document.addEventListener('DOMContentLoaded', function() {
  console.log("DOM fully loaded, initializing UI...");
  // 此时可以安全地操作DOM元素
});

// 改进后的翻译初始化函数
document.addEventListener('DOMContentLoaded', function() {
  // 确保translate.js已加载完成并且DOM已经准备好
  setTimeout(function() {
    console.log("Initializing language settings with enhanced translation...");
    // 使用当前语言初始化界面
    if (typeof switchLanguage === 'function') {
      try {
        // 记录页面中实际存在的导航元素
        var navElements = {
          'tabLinkText': document.getElementById('navLinkText'),
          'tabEncryptText': document.getElementById('navEncryptText'),
          'tabDecryptText': document.getElementById('navDecryptText')
        };
        
        // 添加固定页面文本元素映射
        var pageTextElements = {
          // 标题和导航
          'encryptTabTitle': document.querySelector('#encryptTabTitle'),
          
          // 标签文本
          'publicMessageLabel': document.querySelector('label[for="myTextarea"]'),
          'secretMessageLabel': document.querySelector('label[for="HiddenTextarea"]'),
          'passwordLabel': document.querySelector('label[for="pass1"]'),
          'confirmPasswordLabel': document.querySelector('label[for="pass2"]'),
          'zeroWidthResultLabel': document.querySelector('label[for="coverCopy"]'),
          
          // 按钮文本
          'encryptButton': document.getElementById('tranmake'),
          'copyZeroWidthButton': document.querySelector('.btn.btn-danger[onclick="copyTextarea(\'coverCopy\')"]'),
          
          // 成功消息
          'successMessage': document.querySelector('#encryptinfo span')
        };
        
        // 需要创建的临时元素ID列表
        var requiredElementIds = [
          // Tab相关元素
          'tabLinkText', 'tabEncryptText', 'tabDecryptText',
          
          // 加密页面元素
          'coverTextLabel', 'coverText', 'hiddenTextLabel', 'hiddenText',
          'encryptKeyLabel', 'encryptKey', 'btnZeroWidthEncrypt',
          'btnBinaryEncrypt', 'encryptResultLabel', 'encryptResult',
          'btnCopyEncryptResult', 'encryptInfo',
          
          // 解密页面元素
          'decryptTabTitle', 'decryptInputLabel', 'decryptInput', 'decryptKeyLabel',
          'decryptKey', 'btnZeroWidthDecrypt', 'btnBinaryDecrypt',
          'decryptResultLabel', 'decryptResult', 'btnCopyDecryptResult',
          'decryptInfo'
        ];
        
        // 创建所有必需的临时元素
        requiredElementIds.forEach(function(id) {
          if (!document.getElementById(id)) {
            var tempEl = document.createElement('span');
            tempEl.id = id;
            tempEl.style.display = 'none';
            document.body.appendChild(tempEl);
          }
        });
        
        // 安全地调用switchLanguage初始化翻译
        var userLang = currentLanguage || 'en';
        switchLanguage(userLang);
        
        // 从语言字符串中获取翻译后的文本
        var strings;
        if (window.location.href.includes('encryption.html') || window.location.href.includes('a.html')) {
          // 使用加密页面专用的字符串
          strings = window.languageEncryptionStrings ? 
                   window.languageEncryptionStrings[userLang] || window.languageEncryptionStrings['en'] : 
                   null;
        } else {
          // 使用Tab页通用字符串
          strings = window.languageTabStrings ? 
                   window.languageTabStrings[userLang] || window.languageTabStrings['en'] : 
                   null;
        }
        
        // 更新页面中的文本元素
        if (strings) {
          // 更新标题
          if (pageTextElements.encryptTabTitle) {
            pageTextElements.encryptTabTitle.textContent = strings.encryptTabTitle || 'Character Encryption Tool';
          }
          
          // 更新标签文本
          if (pageTextElements.publicMessageLabel) {
            pageTextElements.publicMessageLabel.innerHTML = '<i class="fas fa-edit me-1"></i>' + (strings.coverTextLabel || 'Public Message (Input)');
          }
          
          if (pageTextElements.secretMessageLabel) {
            pageTextElements.secretMessageLabel.innerHTML = '<i class="fas fa-eye-slash me-1"></i>' + (strings.hiddenTextLabel || 'Secret Message (Input)');
          }
          
          if (pageTextElements.passwordLabel) {
            pageTextElements.passwordLabel.textContent = strings.encryptKeyLabel || 'Password';
          }
          
          if (pageTextElements.confirmPasswordLabel) {
            pageTextElements.confirmPasswordLabel.textContent = strings.encryptKeyLabel ? strings.encryptKeyLabel + ' (Confirm)' : 'Confirm Password';
          }
          
          if (pageTextElements.zeroWidthResultLabel) {
            pageTextElements.zeroWidthResultLabel.innerHTML = '<i class="fas fa-key me-1"></i>' + (strings.encryptResultLabel || 'Zero-Width Encrypted Result (Copy to Share)');
          }
          
          // 更新按钮文本
          if (pageTextElements.encryptButton) {
            pageTextElements.encryptButton.innerHTML = '<i class="fas fa-lock me-2"></i>' + (strings.tranmake || 'Encrypt Note');
          }
          
          if (pageTextElements.copyZeroWidthButton) {
            pageTextElements.copyZeroWidthButton.innerHTML = '<i class="fas fa-copy me-2"></i>' + (strings.btnCopyEncryptResult || 'Copy Zero-Width Result');
          }
          
          // 更新成功消息
          if (pageTextElements.successMessage && strings.mobileAlertMedium) {
            if (window.innerWidth < 576 && strings.mobileAlertShort) {
              pageTextElements.successMessage.textContent = strings.mobileAlertShort;
            } else if (window.innerWidth < 768) {
              pageTextElements.successMessage.textContent = strings.mobileAlertMedium;
            }
          }
          
          // 更新占位符文本
          document.getElementById('myTextarea').placeholder = strings.textareaPlaceholder || 'Write Your Note Here...';
          document.getElementById('HiddenTextarea').placeholder = strings.hiddenTextareaPlaceholder || 'Write Hidden Messages Here...';
          document.getElementById('pass1').placeholder = strings.pass1Placeholder || 'Enter Password';
          document.getElementById('pass2').placeholder = strings.pass2Placeholder || 'Confirm Password';
          document.getElementById('coverCopy').placeholder = strings.encryptResultPlaceholder || 'Encrypted content will appear here';
        }
        
        // 如果需要，更新实际可见的导航元素
        updateNavElements(navElements, userLang);
        
      } catch (e) {
        console.error("Error during enhanced language initialization:", e);
      }
    }
  }, 300); // 使用更长的延迟确保translate.js完全加载
});

// 专门更新导航元素的函数
function updateNavElements(navElements, lang) {
  var commonStrings = window.languageCommonStrings ? 
                     window.languageCommonStrings[lang] || window.languageCommonStrings['en'] : 
                     null;
  
  if (commonStrings) {
    if (navElements['tabLinkText'] || navElements['navLinkText']) {
      var element = navElements['navLinkText'] || navElements['tabLinkText'];
      element.textContent = commonStrings.navLinkText || 'Generate Link';
    }
    
    if (navElements['tabEncryptText'] || navElements['navEncryptText']) {
      var element = navElements['navEncryptText'] || navElements['tabEncryptText'];
      element.textContent = commonStrings.navEncryptText || 'Character Encryption';
    }
    
    if (navElements['tabDecryptText'] || navElements['navDecryptText']) {
      var element = navElements['navDecryptText'] || navElements['tabDecryptText'];
      element.textContent = commonStrings.navDecryptText || 'Decrypt';
    }
  }
}
</script>

<!-- 将translate.js移到这里，确保DOM已经完全加载 -->
<script src="translate.js"></script>
<script>
// 在translate.js加载完成后，初始化语言设置
document.addEventListener('DOMContentLoaded', function() {
  // 确保translate.js已加载完成并且DOM已经准备好
  setTimeout(function() {
    console.log("Initializing language settings...");
    // 使用当前语言初始化界面
    if (typeof switchLanguage === 'function') {
      try {
        // 安全地调用switchLanguage，避免错误中断页面功能
        var navElements = {
          'tabLinkText': document.getElementById('navLinkText'),
          'tabEncryptText': document.getElementById('navEncryptText'),
          'tabDecryptText': document.getElementById('navDecryptText')
        };
        
        // 在调用switchLanguage前，临时添加缺失的元素
        if (!document.getElementById('tabLinkText') && navElements['tabLinkText']) {
          var tempEl = document.createElement('span');
          tempEl.id = 'tabLinkText';
          tempEl.style.display = 'none';
          document.body.appendChild(tempEl);
        }
        
        if (!document.getElementById('tabEncryptText') && navElements['tabEncryptText']) {
          var tempEl = document.createElement('span');
          tempEl.id = 'tabEncryptText';
          tempEl.style.display = 'none';
          document.body.appendChild(tempEl);
        }
        
        if (!document.getElementById('tabDecryptText') && navElements['tabDecryptText']) {
          var tempEl = document.createElement('span');
          tempEl.id = 'tabDecryptText';
          tempEl.style.display = 'none';
          document.body.appendChild(tempEl);
        }
        
        // 添加其他可能缺失的元素
        var requiredIds = ['coverTextLabel', 'coverText', 'hiddenTextLabel', 'hiddenText', 
                          'encryptKeyLabel', 'encryptKey', 'btnZeroWidthEncrypt', 
                          'btnBinaryEncrypt', 'encryptResultLabel', 'encryptResult', 
                          'btnCopyEncryptResult', 'encryptInfo', 'decryptTabTitle',
                          'decryptInputLabel', 'decryptInput', 'decryptKeyLabel', 
                          'decryptKey', 'btnZeroWidthDecrypt', 'btnBinaryDecrypt',
                          'decryptResultLabel', 'decryptResult', 'btnCopyDecryptResult', 
                          'decryptInfo'];
        
        requiredIds.forEach(function(id) {
          if (!document.getElementById(id)) {
            var tempEl = document.createElement('span');
            tempEl.id = id;
            tempEl.style.display = 'none';
            document.body.appendChild(tempEl);
          }
        });
        
        // 现在安全地调用switchLanguage
        switchLanguage(currentLanguage || 'en');
        
        // 更新实际可见的导航元素
        if (navElements['tabLinkText'] && document.getElementById('tabLinkText')) {
          navElements['tabLinkText'].textContent = document.getElementById('tabLinkText').textContent;
        }
        
        if (navElements['tabEncryptText'] && document.getElementById('tabEncryptText')) {
          navElements['tabEncryptText'].textContent = document.getElementById('tabEncryptText').textContent;
        }
        
        if (navElements['tabDecryptText'] && document.getElementById('tabDecryptText')) {
          navElements['tabDecryptText'].textContent = document.getElementById('tabDecryptText').textContent;
        }
        
      } catch (e) {
        console.error("Error during language initialization:", e);
      }
    }
  }, 200); // 使用稍长一点的延迟确保translate.js完全加载
});
</script>

</body>
</html>
